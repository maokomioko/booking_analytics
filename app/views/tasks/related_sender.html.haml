!!! 5
%html
  %head
    %title= t('meta.title')
    %meta{ charset: 'utf-8' }
    /[if IE] <meta http-equiv='X-UA-Compatible' content="IE=edge,IE=9,IE=8,chrome=1" />
    %meta{ content: 'width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0', name: 'viewport' }
    %meta{ content: 'yes', name: 'apple-mobile-web-app-capable' }
    %meta{ content: 'black', name: 'apple-mobile-web-app-status-bar-style' }
    %meta{ content: t('meta.description'), name: 'description' }
    %meta{ content: t('meta.author'), name: 'author' }

    :css
      #map {
        width: 100%;
        height: 500px;
      }

    :javascript
      #{BookingAnalytics::Application.assets.find_asset('related_sender.js.coffee').source}

    :coffeescript
      $ ->
        window.map = Gmaps.build('Google')

        map.buildMap { provider: {}, internal: {id: 'map'}}, ->
          map.getMap().setZoom(16)
          map.getMap().setCenter(new google.maps.LatLng(#{@hotel.latitude.to_f}, #{@hotel.longitude.to_f}))

          map.addMarker
            lat: #{@hotel.latitude.to_f}
            lng: #{@hotel.longitude.to_f}
            marker_title: '#{@hotel.name.html_safe}'
            picture:
              url: 'http://maps.google.com/mapfiles/kml/paddle/blu-stars.png'
              width: 64
              height: 64

          markers = map.addMarkers(#{@markers})
          map.bounds.extendWith(markers)
  %body
    #map
    %table
      - @related_hotels.each do |related_hotel|
        %tr
          %td= related_hotel.related.booking_id
          %td= related_hotel.related.name
          %td= related_hotel.related.exact_class
          %td= related_hotel.related.post_address

    :plain
      <script src="https://maps.google.com/maps/api/js?language=en&v=3.20&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
      <script src='https://google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>